<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  
  <title>contacto</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
<!--captha -->
<script src="https://www.google.com/recaptcha/api.js" async defer></script>
  
  <style>           
      html, body {
      padding: 1% 1% 1% 1%;
      margin: 1% 0% -5% 0%;
      height: 100%;
      width: 100%;
      box-sizing: border-box;
       background-color: #e0e0e0;} 
   #f { background:#e3f2fd ;
        margin: 1% 5% 5% 5%;
        padding: 4% 2% 2% 0%;
        border-radius: 11%;
        height: auto;
   }
   #i{background:#e0e0e0 ;
        margin: 1% 1% 1% 1%;
        padding: 1% 1% 1% 1%;}

</style>

</head>
<body>
  <div id="f"> 
<div class="container-fluid ">
  <div class="row">
   <div class="col-4 "></div>
    <div class="col-4 rounded-3 bg-primary text-center text-white" style="word-wrap: break-word; overflow-wrap: break-word;"> CONTACTO
    </div>
    <div class="col-4 "></div>
  </div>
</div>

<div class="container-fluid mt-2">
    <div class="row">
        <div class="col-6 rounded-4 mt-2 bg-primary text-center text-white p-1" style="margin-left: 25%;">
            <label for="nombreApellido" class="form-label">NOMBRE Y APELLIDO</label>
            <input type="text" class="form-control rounded-4" id="nombreApellido" placeholder="Nombre Y Apellido" name="nombre_apellido">
        </div>
    </div>

    <div class="col-6 rounded-4 mt-2 bg-primary text-center text-white p-1" style="margin-left: 25%;">
        <label for="telUsuario" class="form-label">TEL</label>
        <input type="tel" class="form-control rounded-4" id="telUsuario" placeholder="tel" name="telefono">
    </div>

    <div class="col-6 rounded-4 bg-primary text-center mt-2 text-white p-1" style="margin-left: 25%;">
        <label for="tipoCliente" class="form-label">CLIENTE</label>
        <input type="text" class="form-control rounded-4" id="tipoCliente" placeholder="cliente" name="cliente">
    </div>

    <div class="col-6 rounded-4 bg-primary mt-2 text-center text-white p-1" style="margin-left: 25%;">
        <label for="direccionUsuario" class="form-label">DIRECCION</label>
        <input type="text" class="form-control rounded-4" id="direccionUsuario" placeholder="Direccion, calles,localidad, etc" name="direccion">
    </div>

    <div class="col-6 rounded-4 bg-primary text-center mt-2 text-white p-1" style="margin-left: 25%;">
        <label for="correoUsuario" class="form-label">EMAIL</label>
        <input type="email" class="form-control rounded-4" id="correoUsuario" name="email" placeholder="name@example.com">
    </div>

    <div class="col-10 rounded-4 bg-primary text-center mt-2 text-white p-1" style="margin-left: 8%;">
        <label for="asuntoMensaje" class="form-label">ASUNTO</label>
        <textarea class="form-control rounded-5" id="asuntoMensaje" name="asunto" placeholder="Escribe tu mensaje" rows="3"></textarea>
    </div>

    <div class="col-6 rounded-4 mt-4" style="margin-left: 8%;">
        <div class="g-recaptcha" data-sitekey="6LemOPYrAAAAAMGLt1Gs1XLSL-63bi7xMJHGvGuR"></div>
    </div>

    <button type="button" style="margin-left: 8%" class="btn btn-primary btn-lg mt-4" id="enviarDatosBtn">ENVIAR</button>
</div>
<div id="i"> 
</div>
<script>
// Tu URL sigue siendo la misma:
const URL_DEL_SERVIDOR = 'https://script.google.com/macros/s/AKfycbzVq1vRHmidoRtpcc_WQ66Cjzi7-vMr02Cug7250oLteAosWB_5l_Q9Xhe3ToDvy87udQ/exec'; 
// 1. Enlazar el botÃ³n de envÃ­o
document.getElementById('enviarDatosBtn').addEventListener('click', enviarDatosFormulario);

// ------------------------------------------------
// FUNCIONES DE SEGURIDAD (Frontend)
// ------------------------------------------------

// ğŸ›¡ï¸ Filtro 1: Valida que un campo solo contenga letras (a-z) y espacios.
function validarSoloLetras(texto) {
    if (!texto) return false;
    // ExpresiÃ³n Regular estricta: solo letras mayÃºsculas/minÃºsculas y espacios.
    const soloLetrasRegex = /^[a-zA-Z\s]+$/;
    return soloLetrasRegex.test(texto.trim());
}

// ğŸ›¡ï¸ Filtro 2: Valida un formato bÃ¡sico de email.
function validarEmail(email) {
    if (!email) return false;
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return emailRegex.test(email.trim());
}

// ğŸ›¡ï¸ Filtro 3: Valida el telÃ©fono (permite nÃºmeros, espacios, guiones, y parÃ©ntesis).
function validarTelefono(telefono) {
    if (!telefono) return true; // Asumimos que es opcional si estÃ¡ vacÃ­o
    const telefonoRegex = /^[0-9\s\-\(\)]+$/;
    return telefonoRegex.test(telefono.trim());
}

// ------------------------------------------------

async function enviarDatosFormulario() {
Â  Â Â 
Â  Â  // 2. VERIFICACIÃ“N DE RECAPTCHA (Frontend)
Â  Â  const recaptchaToken = grecaptcha.getResponse();

Â  Â  if (!recaptchaToken) {
Â  Â  Â  Â  alert('Por favor, marca la casilla "No soy un robot". ğŸ¤–');
Â  Â  Â  Â  return;Â 
Â  Â  }

    // 3. RECOLECCIÃ“N DE DATOS (Necesaria para la validaciÃ³n)
Â  Â  const camposFormulario = document.querySelectorAll('input[name], textarea[name]');
Â  Â  const datosParaEnviar = {};

Â  Â  camposFormulario.forEach(campo => {
Â  Â  Â  Â  datosParaEnviar[campo.name] = campo.value;
Â  Â  });

    // âš ï¸ 4. FILTRO DE VALIDACIÃ“N DE CAMPOS (Filtro de Seguridad en el Frontend)
    
    // A. Campos con filtro estricto de SOLO LETRAS y ESPACIOS (Obligatorios)
    const camposSoloLetras = ['nombre_apellido', 'cliente'];
    for (let campo of camposSoloLetras) {
        const valor = datosParaEnviar[campo];
        const nombreVisible = campo.replace('_', ' ');
        
        if (!valor || valor.trim() === "") {
            alert(`El campo '${nombreVisible}' es obligatorio.`);
            document.querySelector(`[name="${campo}"]`).focus();
            return;
        }

        if (!validarSoloLetras(valor)) {
            alert(`Error: El campo ${nombreVisible} solo puede contener letras y espacios.`);
            document.querySelector(`[name="${campo}"]`).focus();
            return;
        }
    }
    
    // B. ValidaciÃ³n del campo EMAIL (Obligatorio)
    if (!validarEmail(datosParaEnviar.email)) {
        alert("El formato del email es invÃ¡lido o el campo estÃ¡ vacÃ­o.");
        document.querySelector('[name="email"]').focus();
        return;
    }
    
    // C. ValidaciÃ³n del campo TELÃ‰FONO (Si existe y tiene valor)
    if (datosParaEnviar.telefono && datosParaEnviar.telefono.trim() !== "" && !validarTelefono(datosParaEnviar.telefono)) {
        alert("El campo telÃ©fono contiene caracteres invÃ¡lidos. Solo se permiten nÃºmeros, espacios, guiones y parÃ©ntesis.");
        document.querySelector('[name="telefono"]').focus();
        return;
    }


    // 5. ADJUNTAR TOKEN (Si las validaciones pasaron)
Â  Â  datosParaEnviar['g-recaptcha-response'] = recaptchaToken;
Â  Â Â 
Â  Â  // 6. CONVERTIR DATOS A QUERY STRING
Â  Â  const queryString = Object.keys(datosParaEnviar).map(key => {
Â  Â  Â  Â  return encodeURIComponent(key) + '=' + encodeURIComponent(datosParaEnviar[key]);
Â  Â  }).join('&');

Â  Â  // 7. ENVÃO (Usando la URL con el query string)
Â  Â  try {
Â  Â  Â  Â  const respuesta = await fetch(`${URL_DEL_SERVIDOR}?${queryString}`, {
Â  Â  Â  Â  Â  Â  method: 'GET'Â 
Â  Â  Â  Â  });

Â  Â  Â  Â  const resultadoTexto = await respuesta.text();Â 
Â  Â  Â  Â  const resultado = JSON.parse(resultadoTexto);

Â  Â  Â  Â  if (resultado.success) {
Â  Â  Â  Â  Â  Â  alert('Â¡Mensaje enviado y guardado con Ã©xito! ğŸ‰');
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  // Captura el error de validaciÃ³n del backend (si lo hay)
Â  Â  Â  Â  Â  Â  console.error('Error del servidor:', resultado.message);
Â  Â  Â  Â  Â  Â  alert(`Error: ${resultado.message}`);
Â  Â  Â  Â  }
Â  Â  } catch (error) {
Â  Â  Â  Â  console.error('Error de red durante la peticiÃ³n fetch:', error);
Â  Â  Â  Â  alert('Error: No se pudo conectar con el servidor.');
Â  Â  } finally {
Â  Â  Â  Â  grecaptcha.reset();Â 
Â  Â  }
}
</script>
</body>
</html>
